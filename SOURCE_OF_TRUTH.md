# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 1. SYSTEM OVERVIEW (–û–±—â–∞—è –∫–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã)

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ ActiveGo**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –≤—Å–µ–≥–æ –∫–æ–¥–∞ (56 —Ñ–∞–π–ª–æ–≤), –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase, RPC, Edge Functions –∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã** –¥–ª—è:
- —Ç–µ–∫—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –±—É–¥—É—â–∏—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫
- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥ –∏ —Ñ—É–Ω–∫—Ü–∏–π

---

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**ActiveGo** ‚Äî marketplace —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∏ –∞—Ä–µ–Ω–¥–Ω—ã—Ö —É—Å–ª—É–≥.

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –∫–ª–∏–µ–Ω—Ç–∞–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥–∏
- –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º —É–ø—Ä–∞–≤–ª—è—Ç—å —É—Å–ª—É–≥–∞–º–∏ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- —Å–∏—Å—Ç–µ–º–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, –æ–ø–ª–∞—Ç—É –∏ –æ—Ç–º–µ–Ω—ã

–ö–ª—é—á–µ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ:
> ‚ùó **–°–∏—Å—Ç–µ–º–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥.**

---

## 2. –ö–ª—é—á–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∏–¥–µ—è

### –£—Å–ª—É–≥–∞ –∂–∏–≤—ë—Ç –≤ –¥–≤—É—Ö —Ñ–∞–∑–∞—Ö

–õ—é–±–∞—è —É—Å–ª—É–≥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç **–¥–≤–µ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ —Ñ–∞–∑—ã**:

### üü¢ –§–∞–∑–∞ 1 ‚Äî –î–û –ø–æ–∫—É–ø–∫–∏ (Service Flow)
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–≤—ã–±–∏—Ä–∞–µ—Ç**
- —Å–∏—Å—Ç–µ–º–∞ **–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**
- —Ü–µ–Ω–∞ **—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è**
- –¥–∞–Ω–Ω—ã–µ **–∫–ª–∞–¥—É—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É**

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ:
- ‚ùå –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤
- ‚ùå –Ω–µ—Ç –æ–ø–ª–∞—Ç
- ‚ùå –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π availability –≤ –ë–î

### üîµ –§–∞–∑–∞ 2 ‚Äî –ü–û–°–õ–ï –ø–æ–∫—É–ø–∫–∏ (Booking Flow)
- –∑–∞–∫–∞–∑ **—É–∂–µ —Å–æ–∑–¥–∞–Ω**
- –æ–ø–ª–∞—Ç–∞ **—É–∂–µ –ø—Ä–æ—à–ª–∞**
- –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å **—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞**
- –≤–æ–∑–º–æ–∂–Ω—ã **–æ—Ç–º–µ–Ω–∞, —à—Ç—Ä–∞—Ñ—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏**

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ:
- ‚ùå –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –≤–∏—Ç—Ä–∏–Ω—ã
- ‚ùå –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ü–µ–Ω—É
- ‚ùå –Ω–µ–ª—å–∑—è ‚Äú–ø–µ—Ä–µ–∏–≥—Ä—ã–≤–∞—Ç—å‚Äù availability

---

## 3. –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Å–∏—Å—Ç–µ–º—ã

> **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å Service Flow –∏ Booking Flow.**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- `service.*` —Ñ–∞–π–ª—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ç–∞–±–ª–∏—Ü–µ–π `orders`
- `booking.*` —Ñ–∞–π–ª—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —É–ø—Ä–∞–≤–ª—è—é—Ç UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ª—É–≥–∏
- —Å–≤—è–∑—å –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏ ‚Äî **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –¥–∞–Ω–Ω—ã–µ** (`cart_items ‚Üí orders`)

–ù–∞—Ä—É—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ª–æ–º–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É**.

---

## 4. Source of Truth –≤ —Å–∏—Å—Ç–µ–º–µ

–í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∏—Å—Ç–∏–Ω—ã**, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π.

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏:

1. **orders** ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω—ã–π Source of Truth
   - –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å –≤ `orders`, –∑–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - availability –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ `orders`

2. **service_dates / service_day_bookings**
   - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
   - –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —è–≤–ª—è—é—Ç—Å—è ‚Äú–ø–µ—Ä–≤–æ–ø—Ä–∏—á–∏–Ω–æ–π‚Äù
   - –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã –æ—Ç –∑–∞–∫–∞–∑–æ–≤

3. **cart_items**
   - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ availability
   - –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω–æ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π

---

## 5. –ñ—ë—Å—Ç–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ù–ò–ö–û–ì–î–ê –ù–ï –ù–ê–†–£–®–ê–¢–¨)

### ‚ùó –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 1. Availability —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞
- –µ—Å–ª–∏ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω ‚Üí availability –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω ‚Üí availability –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

### ‚ùó –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 2. Cancel Contract
–ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ **–í–°–ï–ì–î–ê**:
1. restore availability  
2. update `orders.status`

–ù–∏–∫–æ–≥–¥–∞ –Ω–∞–æ–±–æ—Ä–æ—Ç.

### ‚ùó –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 3. Frontend –Ω–µ –≤–ª–∞–¥–µ–µ—Ç –∏—Å—Ç–∏–Ω–æ–π
- frontend **–Ω–µ —Ä–µ—à–∞–µ—Ç**, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞
- frontend **–Ω–µ –º–µ–Ω—è–µ—Ç** availability –Ω–∞–ø—Ä—è–º—É—é
- frontend —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## 6. –¢–∏–ø—ã —É—Å–ª—É–≥ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)

–¢–∏–ø —É—Å–ª—É–≥–∏ ‚Äî **–Ω–µ —Ñ–∞–π–ª –∏ –Ω–µ —Ç–∞–±–ª–∏—Ü–∞**.

–¢–∏–ø —É—Å–ª—É–≥–∏ ‚Äî —ç—Ç–æ **–Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª**, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö:
- –≤ Service Flow (–¥–æ –ø–æ–∫—É–ø–∫–∏)
- –≤ Booking Flow (–ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏)

–ü—Ä–∏–º–µ—Ä—ã:
- `rental` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º
- `tour` ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞, –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ç–∏–ø —É—Å–ª—É–≥–∏:
- –¥–æ–±–∞–≤–ª—è–µ—Ç **—Å–≤–æ—é –ª–æ–≥–∏–∫—É**
- **–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é**

---

## 7. –ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –∑–æ–Ω—ã:
- Service Flow (`service.<type>.js`, `service.availability.<type>.js`)
- Booking availability (apply / restore –ø–æ —Ç–∏–ø—É —É—Å–ª—É–≥–∏)
- RPC –∏ Edge Functions

### –ù–µ—Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –∑–æ–Ω—ã:
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `orders`
- Cancel Contract
- –ø–æ—Ä—è–¥–æ–∫ payment ‚Üí orders ‚Üí availability

---

## 8. –ì—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–ª–æ—ë–≤

| –°–ª–æ–π | –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ |
|----|----|
| Frontend UI | –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö |
| Service Layer | –≤—ã–±–æ—Ä, —Ä–∞—Å—á—ë—Ç, –∫–æ—Ä–∑–∏–Ω–∞ |
| Cart Layer | –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| Payment | —Ñ–∞–∫—Ç –æ–ø–ª–∞—Ç—ã |
| Booking Layer | —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–º |
| Availability | —Ä–∞—Å—á—ë—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ |
| Database | –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã |

---

## 9. –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∫—Ä–∏—Ç–∏—á–µ–Ω

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç:
- –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ö–∞–æ—Å
- –∏—Å–∫–ª—é—á–∞–µ—Ç ‚Äú—Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–∞–≤–∫–∏‚Äù
- –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏
- –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–¥

---

### –°—Ç–∞—Ç—É—Å
- –ß–ê–°–¢–¨ 1 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã **—Ç–æ–ª—å–∫–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ**


---

## 2. Frontend: –æ–±—â–∏–π –æ–±–∑–æ—Ä

Frontend –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–∏—Å—Ç–∏–Ω—ã.
–û–Ω:
- –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥
- –≤—ã–∑—ã–≤–∞–µ—Ç backend / RPC
- **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã

---

## 3. Frontend ‚Äî Entry Points –∏ Layout

### `index.html`
**–†–æ–ª—å:** Landing page  
- read-only –≤–∏—Ç—Ä–∏–Ω–∞
- –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `index.js`

---

### `index.js`
**–†–æ–ª—å:** –ª–æ–≥–∏–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã  
- –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥
- –ø–µ—Ä–≤–∏—á–Ω—ã–π UX
- –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### `header.html`
**–†–æ–ª—å:** –≥–ª–æ–±–∞–ª—å–Ω—ã–π layout  
- –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- –æ–±—â–∏–µ UI-–±–ª–æ–∫–∏

---

### `header.js`
**–†–æ–ª—å:** role-aware navigation  
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ–Ω—é
- –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

---

## 4. Authentication & Registration

### `login.html`
### `login-provider.html`
### `register.html`
### `register-provider.html`
**–†–æ–ª—å:** UI –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
- —Ä–∞–∑–ª–∏—á–∏–µ client / provider
- –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

### `oauth-callback.html`
**–†–æ–ª—å:** —Ñ–∏–Ω–∞–ª OAuth  
- –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- bootstrap `profiles`

---

### `auth.js`
**–†–æ–ª—å:** Auth helper  
- –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
- –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## 5. Catalog & Discovery

### `catalog.html`
**–†–æ–ª—å:** —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞  
- —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
- —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≤–∏–∑—É–∞–ª—å–Ω–∞—è)

---

### `catalog.js`
**–†–æ–ª—å:** –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥  
- —á—Ç–µ–Ω–∏–µ `services`
- –Ω–∏–∫–∞–∫–æ–π availability-–ª–æ–≥–∏–∫–∏
- –Ω–∏–∫–∞–∫–æ–≥–æ cart / booking

---

## 6. Service Flow (–î–û –ø–æ–∫—É–ø–∫–∏)

### `service.html`
**–†–æ–ª—å:** page shell —É—Å–ª—É–≥–∏  
- HTML-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –±–µ–∑ –ª–æ–≥–∏–∫–∏

---

### `service.js`
**–†–æ–ª—å:** entry-point  
- –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `service.base.js`
- –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫–∏

---

### `service.base.js`
**–†–æ–ª—å:** –≥–ª–∞–≤–Ω—ã–π orchestrator —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ª—É–≥–∏  
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –∑–∞–≥—Ä—É–∑–∫—É —É—Å–ª—É–≥–∏ (`services`)
- –∑–∞–≥—Ä—É–∑–∫—É availability-–¥–∞–Ω–Ω—ã—Ö
- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `activity_type`
- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ª–æ–≥–∏–∫–∏ —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É

‚ùó –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- —Ä–∞–±–æ—Ç–∞—Ç—å —Å `orders`
- –ø—Ä–∏–º–µ–Ω—è—Ç—å availability
- —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç–∏–ø-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É

---

### `service.rental.js`
**–†–æ–ª—å:** Rental UI + pricing  
- –≤—ã–±–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
- —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
- –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `cartData`

---

### `service.tour.js`
**–†–æ–ª—å:** Tour UI + capacity  
- –≤—ã–±–æ—Ä –¥–∞—Ç—ã
- –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `cartData`

---

### `service.availability.rental.js`
**–†–æ–ª—å:** –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞—Ä–µ–Ω–¥—ã  
- booked / blocked / available
- —Ä–∞—Å—á—ë—Ç—ã –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
- –Ω–µ –∑–Ω–∞–µ—Ç –æ Supabase

---

### `service.availability.tour.js`
**–†–æ–ª—å:** –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç—É—Ä–æ–≤  
- capacity ‚àí booked
- read-only

---

## 7. Cart & Checkout

### `cart.html`
**–†–æ–ª—å:** UI –∫–æ—Ä–∑–∏–Ω—ã

---

### `cart.js`
**–†–æ–ª—å:** cart orchestration  
- –∑–∞–≥—Ä—É–∑–∫–∞ `cart_items`
- —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- –ø–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ

---

### `success.html`
**–†–æ–ª—å:** post-payment —ç–∫—Ä–∞–Ω  
- –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫–∏

---

## 8. Booking Flow (–ü–û–°–õ–ï –ø–æ–∫—É–ø–∫–∏)

### `booking.html`
**–†–æ–ª—å:** UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### `booking.js`
**–†–æ–ª—å:** entry-point  
- –ø–æ–¥–∫–ª—é—á–∞–µ—Ç base / client / provider

---

### `booking.base.js`
**–†–æ–ª—å:** –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è  
- –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞
- access control
- role resolution

---

### `booking.client.js`
**–†–æ–ª—å:** –æ—Ç–º–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º  
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏
- restore availability
- update orders

---

### `booking.provider.js`
**–†–æ–ª—å:** –æ—Ç–º–µ–Ω–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º  
- –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω
- —à—Ç—Ä–∞—Ñ—ã
- restore availability
- update orders

---

### `cancel.rules.js`
**–†–æ–ª—å:** —è–¥—Ä–æ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –æ—Ç–º–µ–Ω  
- –ø–æ–ª–∏—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω
- —à—Ç—Ä–∞—Ñ—ã
- —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω

---

## 9. Dashboards

### `dashboard.html`
### `dashboard.js`
**–†–æ–ª—å:** client dashboard  
- –∞–∫—Ç–∏–≤–Ω—ã–µ / –∞—Ä—Ö–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- read-only

---

### `dashboard-provider.html`
### `provider-dashboard.js`
**–†–æ–ª—å:** provider dashboard  
- –¥–æ—Ö–æ–¥—ã
- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –≤—ã–ø–ª–∞—Ç—ã

---

## 10. Provider Area

### `provider-services.html`
### `provider-services.js`
**–†–æ–ª—å:** —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

---

### `add-service.html`
### `add-service.js`
**–†–æ–ª—å:** —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥–∏

---

### `edit-service.html`
### `edit-service.js`
**–†–æ–ª—å:** —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏  
- availability
- –¥–∞—Ç—ã
- –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

### `provider-bookings.html`
### `provider-bookings.js`
**–†–æ–ª—å:** –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### `provider-bookings-archive.html`
### `provider-bookings-archive.js`
**–†–æ–ª—å:** –∞—Ä—Ö–∏–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (read-only)

---

### `provider-payouts.html`
### `provider-payouts.js`
**–†–æ–ª—å:** –≤—ã–ø–ª–∞—Ç—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫—É (read-only)

---

## 11. Admin

### `admin.html`
### `admin.js`
**–†–æ–ª—å:** –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å  
- –º–æ–¥–µ—Ä–∞—Ü–∏—è
- –æ–±–∑–æ—Ä –¥–∞–Ω–Ω—ã—Ö

---

## 12. Infrastructure / External

### `supabaseClient.js`
**–†–æ–ª—å:** frontend Supabase client  
- anon key
- —Ç–æ–ª—å–∫–æ read / allowed write

---

### `telegram-bot.js`
**–†–æ–ª—å:** –≤–Ω–µ—à–Ω–∏–π backend-—Å–µ—Ä–≤–∏—Å  
- Telegram API
- service-role Supabase
- bypass RLS

‚ùó –ù–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é frontend-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

## 13. Static / Legal

### `privacy.html`
### `terms.html`
**–†–æ–ª—å:** —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã  
- –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –ª–æ–≥–∏–∫–µ

---

## 14. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏

### `styles.css`
**–†–æ–ª—å:** global design system  
- –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

### –°—Ç–∞—Ç—É—Å
- –ß–ê–°–¢–¨ 2 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ—á–∏—â–µ–Ω–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 3. Authentication, Roles, Profiles, RLS

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–∞–±–ª–∏—Ü—É profiles –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã RLS**.
–û–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å –¥–æ—Å—Ç—É–ø–∞–º–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é.

---

## 1. –û–±—â–∞—è –º–æ–¥–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

ActiveGo –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Supabase Auth** –∫–∞–∫ –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–ø–æ—Å–æ–±—ã –≤—Ö–æ–¥–∞:
- Email + password
- OAuth (—á–µ—Ä–µ–∑ Supabase)

Supabase Auth:
- –æ—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –∑–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**
- –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏—á–µ–≥–æ –æ —Ä–æ–ª—è—Ö –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ

---

## 2. –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Conceptual)

–í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç **—Ä–æ–≤–Ω–æ 4 —Ä–æ–ª–∏**:

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|----|
| guest | –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| client | –∫–ª–∏–µ–Ω—Ç, –±—Ä–æ–Ω–∏—Ä—É—é—â–∏–π —É—Å–ª—É–≥–∏ |
| provider | –ø–æ—Å—Ç–∞–≤—â–∏–∫ —É—Å–ª—É–≥ |
| admin | –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã |

‚ùó –†–æ–ª—å **–ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è** –≤ Auth metadata  
‚ùó –†–æ–ª—å **–í–°–ï–ì–î–ê —Ö—Ä–∞–Ω–∏—Ç—Å—è** –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles`

---

## 3. –¢–∞–±–ª–∏—Ü–∞ profiles

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:  
–¢–∞–±–ª–∏—Ü–∞ `profiles` —è–≤–ª—è–µ—Ç—Å—è **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```sql
profiles (
  id uuid primary key references auth.users(id),
  role text,                    -- client | provider | admin
  name text,
  notify_channel text,
  telegram_id text,
  whatsapp_phone text,
  created_at timestamptz
)
4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

–ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è:

–ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–ø—Ä–∏ –ø–µ—Ä–≤–æ–º OAuth-–≤—Ö–æ–¥–µ

–ì–¥–µ:

frontend (auth.js, oauth-callback.html)

backend (Edge Functions –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

‚ùó –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é –≤ SQL.

5. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –≤–æ Frontend

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö:

auth.js

service.base.js

header.js

booking.base.js

–ê–ª–≥–æ—Ä–∏—Ç–º:

–ü–æ–ª—É—á–∞–µ–º session —á–µ—Ä–µ–∑ supabase.auth.getSession()

–ó–∞–≥—Ä—É–∂–∞–µ–º profiles.role

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–æ–ª—å —Ç–æ–ª—å–∫–æ –¥–ª—è UI –∏ routing

‚ùó Frontend –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ –¥–µ–ª–∞–µ—Ç RLS.

6. RLS ‚Äî –æ–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

Row Level Security –≤–∫–ª—é—á—ë–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö, –∫—Ä–æ–º–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö.

–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:

Frontend (anon key) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ RLS.

7. RLS: –∫–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
services

—á–∏—Ç–∞—Ç—å: –≤—Å–µ

–ø–∏—Å–∞—Ç—å: —Ç–æ–ª—å–∫–æ provider (owner)

admin: –≤—Å—ë

cart_items

—á–∏—Ç–∞—Ç—å: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü (user_id = auth.uid())

–ø–∏—Å–∞—Ç—å: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

—É–¥–∞–ª—è—Ç—å: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

orders

—á–∏—Ç–∞—Ç—å:

client ‚Üí —Å–≤–æ–∏

provider ‚Üí —Å–≤–æ–∏

admin ‚Üí –≤—Å–µ

–ø–∏—Å–∞—Ç—å:

–¢–û–õ–¨–ö–û backend / Edge / Stripe webhook

–æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å:

client ‚Üí cancelled_by_client

provider ‚Üí cancelled_by_provider

service_dates

—á–∏—Ç–∞—Ç—å: –≤—Å–µ

–ø–∏—Å–∞—Ç—å: provider (—á–µ—Ä–µ–∑ UI) –∏–ª–∏ backend

–æ–±–Ω–æ–≤–ª—è—Ç—å booked: –¢–û–õ–¨–ö–û backend / RPC

service_day_bookings

—á–∏—Ç–∞—Ç—å: –≤—Å–µ

–ø–∏—Å–∞—Ç—å: –¢–û–õ–¨–ö–û backend / RPC

8. Service Role vs Anon Key

anon key:

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ frontend (supabaseClient.js)

–ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è RLS

service role key:

Edge Functions

Telegram bot

Stripe webhook

‚ùó Service role –æ–±—Ö–æ–¥–∏—Ç RLS
‚ùó –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤–æ frontend

9. Edge Functions –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Edge Functions:

–∏—Å–ø–æ–ª—å–∑—É—é—Ç service role

–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

—è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é Source of Truth

Frontend:

–Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å availability –Ω–∞–ø—Ä—è–º—É—é

–Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å orders

–Ω–µ –º–æ–∂–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å cancel policy

10. –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

—Ö—Ä–∞–Ω–∏—Ç—å —Ä–æ–ª—å –≤ auth.users

–ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ —Ç–æ–ª—å–∫–æ –≤–æ frontend

–ø–∏—Å–∞—Ç—å –≤ orders –Ω–∞–ø—Ä—è–º—É—é –∏–∑ UI

–º–µ–Ω—è—Ç—å availability –±–µ–∑ RPC

11. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–æ–ª–µ–π

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ä–æ–ª–∏:

–¥–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ profiles.role

–æ–±–Ω–æ–≤–∏—Ç—å RLS

–æ–±–Ω–æ–≤–∏—Ç—å UI routing

‚ùó –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–æ–ª—å –±–µ–∑ RLS.

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 4. Database Schema (—Ç–∞–±–ª–∏—Ü—ã, —Å–≤—è–∑–∏, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **—Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ActiveGo**, –µ—ë —Ç–∞–±–ª–∏—Ü—ã, —Å–≤—è–∑–∏ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã.
–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î –¥–æ–ª–∂–Ω—ã —Å–≤–µ—Ä—è—Ç—å—Å—è —Å —ç—Ç–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º.

---

## 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî **–æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**
- –í—Å–µ –±–∏–∑–Ω–µ—Å-–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
  - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –æ—Ç–º–µ–Ω–∞
  - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  
  –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **—á–µ—Ä–µ–∑ backend / RPC / Edge**
- Frontend **–Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞** –Ω–∞–ø—Ä—è–º—É—é –º–µ–Ω—è—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## 2. –¢–∞–±–ª–∏—Ü–∞ `services`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç **–æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏**, –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```sql
services (
  id uuid primary key,
  provider_id uuid references profiles(id),
  title text,
  description text,
  price numeric,
  pricing_type text,          -- per_unit | per_person | etc
  unit_label text,
  duration_min integer,
  duration_max integer,
  location text,
  main_image text,
  gallery_images text[],
  activity_type text,         -- rental | tour | future types
  total_units integer,        -- –¥–ª—è rental
  rental_day_mode text,       -- calendar | nights
  status text,                -- active | inactive
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
activity_type –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –í–°–Æ –¥–∞–ª—å–Ω–µ–π—à—É—é –ª–æ–≥–∏–∫—É

services –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç availability

price ‚Äî –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ service_dates

3. –¢–∞–±–ª–∏—Ü–∞ service_dates (—Ç—É—Ä—ã / —Å–æ–±—ã—Ç–∏—è)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç –¥–∞—Ç—ã –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —É—Å–ª—É–≥ —Å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é (tour-like).

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
service_dates (
  id uuid primary key,
  service_id uuid references services(id),
  date date,
  capacity integer,
  booked integer,
  price_override numeric,
  status text,               -- active | inactive
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
capacity ‚Äî –º–∞–∫—Å–∏–º—É–º –º–µ—Å—Ç

booked ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

booked –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ RPC

capacity - booked >= 0 –≤—Å–µ–≥–¥–∞

4. –¢–∞–±–ª–∏—Ü–∞ service_unavailability (–∞—Ä–µ–Ω–¥–∞)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–∞—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º (—á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–ª–∏ –ø–æ–ª–Ω—ã–µ).

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
service_unavailability (
  id uuid primary key,
  service_id uuid references services(id),
  date_from date,
  date_to date,
  blocked_units integer,     -- null = –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
blocked_units = null ‚Üí –¥–µ–Ω—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è rental

5. –¢–∞–±–ª–∏—Ü–∞ service_day_bookings (–∞—Ä–µ–Ω–¥–∞)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ –¥–Ω—è–º –¥–ª—è –∞—Ä–µ–Ω–¥—ã.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
service_day_bookings (
  id uuid primary key,
  service_id uuid references services(id),
  date date,
  booked_units integer,
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
—Å—Ç—Ä–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ booked_units > 0

–ø—Ä–∏ booked_units = 0 —Å—Ç—Ä–æ–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è

–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ RPC

6. –¢–∞–±–ª–∏—Ü–∞ cart_items
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ –æ–ø–ª–∞—Ç—ã.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
cart_items (
  id uuid primary key,
  user_id uuid references profiles(id),
  provider_id uuid,
  service_id uuid references services(id),
  service_date_id uuid null,
  service_title text,
  booking_date date null,
  booking_date_from date null,
  booking_date_to date null,
  quantity integer,
  unit_price numeric,
  total_price numeric,
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
–¥–∞–Ω–Ω—ã–µ –ù–ï –≤–ª–∏—è—é—Ç –Ω–∞ availability

–º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π

–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è checkout

7. –¢–∞–±–ª–∏—Ü–∞ orders (–ì–õ–ê–í–ù–ê–Ø)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ê–±—Å–æ–ª—é—Ç–Ω—ã–π Source of Truth –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
orders (
  id bigint primary key,
  user_id uuid references profiles(id),
  provider_id uuid references profiles(id),
  service_id uuid references services(id),
  service_date_id uuid null,
  booking_date date null,
  booking_date_from date null,
  booking_date_to date null,
  quantity integer,
  unit_price numeric,
  total_price numeric,
  status text,                -- confirmed | cancelled_by_client | cancelled_by_provider
  stripe_session_id text,
  cancelled_at timestamptz,
  cancelled_by text,
  penalty_percent integer,
  provider_cancel_reason text,
  created_at timestamptz
)
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
–∫–∞–∂–¥—ã–π order = –æ–¥–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

availability –≤—Å–µ–≥–¥–∞ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞ orders

orders —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

orders –ù–ò–ö–û–ì–î–ê –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

8. –¢–∞–±–ª–∏—Ü–∞ reviews
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å–ª—É–≥–∏.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
reviews (
  id uuid primary key,
  service_id uuid references services(id),
  user_id uuid references profiles(id),
  rating integer,
  comment text,
  created_at timestamptz
)
9. –¢–∞–±–ª–∏—Ü–∞ profiles
(–æ–ø–∏—Å–∞–Ω–∞ –≤ –ß–ê–°–¢–ò 3, –≤–∫–ª—é—á–µ–Ω–∞ –∑–¥–µ—Å—å –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏)

10. –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
scss
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
auth.users
   ‚Üì
profiles
   ‚Üì
services
   ‚Üì
service_dates (tour)
service_day_bookings (rental)
   ‚Üì
orders
11. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã
‚ùå –ù–µ–ª—å–∑—è:

–ø–∏—Å–∞—Ç—å –≤ orders –∏–∑ frontend

–º–µ–Ω—è—Ç—å booked –Ω–∞–ø—Ä—è–º—É—é

–≤—ã—á–∏—Å–ª—è—Ç—å availability –±–µ–∑ –ë–î

—É–¥–∞–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏–∑ orders

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 5. RPC Functions (Availability, Apply, Restore)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–≤—Å–µ RPC-—Ñ—É–Ω–∫—Ü–∏–∏ Supabase**, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∞—Å—Ç–≤—É—é—Ç
–≤ —Ä–∞—Å—á—ë—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
–ø—Ä–∏ –æ—Ç–º–µ–Ω–∞—Ö.

RPC ‚Äî —ç—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–ø–æ—Å–æ–±** –∏–∑–º–µ–Ω—è—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

## 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã RPC

- RPC ‚Äî —ç—Ç–æ **backend-–ª–æ–≥–∏–∫–∞**
- RPC —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **service role**
- RPC —è–≤–ª—è–µ—Ç—Å—è **—á–∞—Å—Ç—å—é Source of Truth**
- Frontend:
  - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å RPC
  - **–Ω–µ –∑–Ω–∞–µ—Ç**, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞—Å—á—ë—Ç

‚ùó –õ—é–±–∞—è –ª–æ–≥–∏–∫–∞ availability **–æ–±—è–∑–∞–Ω–∞** –∂–∏—Ç—å –≤ RPC –∏–ª–∏ Edge Functions.

---

## 2. RPC: get_rental_calendar

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã **–ø–æ –¥–Ω—è–º**.

### –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- `service.base.js`
- `service.rental.js`

### –°–∏–≥–Ω–∞—Ç—É—Ä–∞
```sql
get_rental_calendar(
  p_service_id uuid,
  p_date_from date,
  p_date_to date
)
date,
total_units,
blocked_units,
booked_units,
available_units,
is_fully_blocked

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

services.total_units

service_unavailability

service_day_bookings

–ù–ï —Å–æ–∑–¥–∞—ë—Ç –∏ –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

read-only

3. RPC: check_rental_availability
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ñ—ë—Å—Ç–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º order.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

Stripe webhook

Backend checkout flow

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
check_rental_availability(
  p_service_id uuid,
  p_date_from date,
  p_date_to date,
  p_quantity integer
)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ

–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞

–µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí ERROR

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ final gate

4. RPC: restore_day_booking (RENTAL)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –ø–æ –¥–Ω—è–º –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

booking.client.js

booking.provider.js

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
restore_day_booking(
  p_service_id uuid,
  p_date date,
  p_units integer
)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ

—É–º–µ–Ω—å—à–∞–µ—Ç booked_units

–µ—Å–ª–∏ booked_units = 0 ‚Üí —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É

–±–µ–∑–æ–ø–∞—Å–Ω–∞ –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –≤—ã–∑–æ–≤–∞–º

5. RPC: apply_tour_booking_by_order (TOUR)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü—Ä–∏–º–µ–Ω—è–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ order.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

Stripe webhook

Backend checkout flow

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
apply_tour_booking_by_order(
  p_order_id bigint
)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ

—á–∏—Ç–∞–µ—Ç orders

–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ service_dates

—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç booked –Ω–∞ orders.quantity

6. RPC: restore_tour_by_order (TOUR)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

booking.client.js

booking.provider.js

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
restore_tour_by_order(
  p_order_id bigint
)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ

—á–∏—Ç–∞–µ—Ç orders

—É–º–µ–Ω—å—à–∞–µ—Ç service_dates.booked –Ω–∞ orders.quantity

–ù–ï –æ–±–Ω—É–ª—è–µ—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –±—Ä–æ–Ω–∏

–Ω–µ —É–¥–∞–ª—è–µ—Ç service_dates

7. –£–î–ê–õ–Å–ù–ù–´–ï RPC (–ó–ê–ü–†–ï–©–ï–ù–´)

–°–ª–µ–¥—É—é—â–∏–µ RPC –ù–ï –î–û–õ–ñ–ù–´ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å:

increment_service_date_booked

restore_tour_capacity

–ª—é–±—ã–µ RPC –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ orders

–ü—Ä–∏—á–∏–Ω–∞:

–û–Ω–∏ –Ω–∞—Ä—É—à–∞—é—Ç —Å–∏–º–º–µ—Ç—Ä–∏—é availability ‚Üî orders.

8. –°–∏–º–º–µ—Ç—Ä–∏—è apply / restore (–ö–õ–Æ–ß–ï–í–û–ï –ü–†–ê–í–ò–õ–û)
–¢–∏–ø —É—Å–ª—É–≥–∏	Apply	Restore
rental	insert/update service_day_bookings	restore_day_booking
tour	apply_tour_booking_by_order	restore_tour_by_order

‚ùó –õ—é–±–æ–π –Ω–æ–≤—ã–π —Ç–∏–ø —É—Å–ª—É–≥–∏ –û–ë–Ø–ó–ê–ù —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.

9. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ RPC –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥

–î–ª—è –Ω–æ–≤–æ–≥–æ activity_type:

—Å–æ–∑–¥–∞—Ç—å:

apply_<type>_booking_by_order

restore_<type>_by_order

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û order_id

–Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å quantity –∏–∑ frontend

–Ω–µ –ø–∏—Å–∞—Ç—å –≤ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é

10. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

RPC –¥–æ–ª–∂–Ω–∞:

–±—Ä–æ—Å–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ apply

–±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π –ø—Ä–∏ restore

Frontend:

–ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É

–Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è ‚Äú—á–∏–Ω–∏—Ç—å‚Äù availability

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 6. Payment & Stripe Webhook Flow

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–ø–ª–∞—Ç—ã** –≤ ActiveGo:
–æ—Ç –∫–æ—Ä–∑–∏–Ω—ã –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è availability.

–û–ø–ª–∞—Ç–∞ ‚Äî —ç—Ç–æ **—Ç–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞**: –ø–æ—Å–ª–µ –Ω–µ—ë —Å–æ–∑–¥–∞—é—Ç—Å—è orders –∏ –º–µ–Ω—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.

---

## 1. –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø –æ–ø–ª–∞—Ç—ã

> ‚ùó **Orders —Å–æ–∑–¥–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã.**

–ù–∏–∫–æ–≥–¥–∞:
- –¥–æ –æ–ø–ª–∞—Ç—ã
- –ø–æ –∫–ª–∏–∫—É –∫–Ω–æ–ø–∫–∏
- –ø–æ –≤–æ–∑–≤—Ä–∞—Ç—É success.html

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä:
- `checkout.session.completed` (Stripe webhook)

---

## 2. –û–±—â–∞—è —Å—Ö–µ–º–∞ Payment Flow

cart_items
‚Üì
Stripe Checkout
‚Üì
Stripe Webhook (Edge Function)
‚Üì
orders (insert)
‚Üì
apply availability (RPC)
‚Üì
cart_items (clear)


Frontend **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–æ–∑–¥–∞—ë—Ç orders.

---

## 3. –ö–æ—Ä–∑–∏–Ω–∞ (cart_items)

### –†–æ–ª—å
- –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ availability
- –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω–∞ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `cart.js`
- Stripe webhook

---

## 4. Stripe Checkout

### –ß—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ Stripe
- total_price
- metadata:
  - `user_id`
  - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ session / context)

### –ß–µ–≥–æ –ù–ï–¢ –≤ Stripe
- availability
- service logic
- –¥–∞—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

Stripe **–Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏—á–µ–≥–æ** –æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ.

---

## 5. Stripe Webhook (Backend)

### –§–∞–π–ª
- Stripe webhook (Edge Function / backend script)

### –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ —Å–æ–±—ã—Ç–∏–µ
```text
checkout.session.completed

–£—Å–ª–æ–≤–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

payment_status === "paid"

metadata —Å–æ–¥–µ—Ä–∂–∏—Ç user_id

6. –õ–æ–≥–∏–∫–∞ Stripe Webhook (–ü–û–®–ê–ì–û–í–û)
–®–∞–≥ 1. –ó–∞–≥—Ä—É–∑–∫–∞ cart_items

–ø–æ user_id

–≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã

–®–∞–≥ 2. –ñ—ë—Å—Ç–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ availability

–¢–û–õ–¨–ö–û –¥–ª—è rental:

check_rental_availability

–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí abort (409)

–®–∞–≥ 3. –°–æ–∑–¥–∞–Ω–∏–µ orders

–∫–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π order

—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

service_id

dates

quantity

price

stripe_session_id

status = confirmed

–®–∞–≥ 4. Apply availability

rental:

insert/update service_day_bookings

tour:

apply_tour_booking_by_order(order_id)

–®–∞–≥ 5. –û—á–∏—Å—Ç–∫–∞ cart_items

–ø–æ user_id

7. –ü–æ—á–µ–º—É availability –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï orders

–ü—Ä–∏—á–∏–Ω–∞:

orders = Source of Truth

availability –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞ orders

restore —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ order_id

‚ùó –ï—Å–ª–∏ availability –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–Ω—å—à–µ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.

8. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –î–û orders

–Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

Stripe session —Å—á–∏—Ç–∞–µ—Ç—Å—è failed

–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ü–û–°–õ–ï orders

—Å—á–∏—Ç–∞–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π

—Ç—Ä–µ–±—É–µ—Ç manual intervention

availability –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å orders

9. success.html
–†–æ–ª—å

UI –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã

–ù–ï —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

–ù–ï —Å–æ–∑–¥–∞—ë—Ç orders

‚ùó success.html ‚Äî —á–∏—Å—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω.

10. –í–æ–∑–≤—Ä–∞—Ç—ã –∏ –æ—Ç–º–µ–Ω—ã
Refunds

–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–æ—Ç–º–µ–Ω–∞ = –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–µ Stripe

–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

–≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ Booking Flow

–≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç restore availability

11. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã

‚ùå –ù–µ–ª—å–∑—è:

—Å–æ–∑–¥–∞–≤–∞—Ç—å orders –≤–æ frontend

–ø—Ä–∏–º–µ–Ω—è—Ç—å availability –±–µ–∑ –æ–ø–ª–∞—Ç—ã

–¥–æ–≤–µ—Ä—è—Ç—å success.html

–≤—ã–∑—ã–≤–∞—Ç—å apply RPC –∏–∑ UI

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 7. Booking Flow & Cancel Contract (Client / Provider)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã**:
–ø—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–º–µ–Ω—É, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω.

–≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–¥–µ–ª** —Å–∏—Å—Ç–µ–º—ã. –ï–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–æ–º–∞–µ—Ç availability.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Booking Flow

Booking Flow –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è **–ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ orders**.

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ:
- —É—Å–ª—É–≥–∞ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–∞
- availability —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- –∑–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç UI

Booking Flow –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞:
- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- –æ—Ç–º–µ–Ω—É –∑–∞–∫–∞–∑–∞
- —à—Ç—Ä–∞—Ñ—ã
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ availability

---

## 2. –£—á–∞—Å—Ç–Ω–∏–∫–∏ Booking Flow

| –†–æ–ª—å | –§–∞–π–ª |
|----|----|
| –û–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç | `booking.base.js` |
| –ö–ª–∏–µ–Ω—Ç | `booking.client.js` |
| –ü–æ—Å—Ç–∞–≤—â–∏–∫ | `booking.provider.js` |

---

## 3. booking.base.js ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

### –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞ (`orders`)
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞:
  - client ‚Üí `user_id`
  - provider ‚Üí `provider_id`
- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è (client / provider)

‚ùó –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω.

---

## 4. Cancel Contract (–ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü)

> ‚ùó **Cancel Contract ‚Äî —ç—Ç–æ –¥–æ–≥–æ–≤–æ—Ä –º–µ–∂–¥—É –∫–æ–¥–æ–º –∏ –±–∞–∑–æ–π.**

–û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:
- —Å–∏–º–º–µ—Ç—Ä–∏—é availability ‚Üî orders
- –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ‚Äú—É—Ç–µ—á–µ–∫‚Äù –±—Ä–æ–Ω–∏

---

## 5. Cancel Contract ‚Äî –ñ–Å–°–¢–ö–ò–ï –ü–†–ê–í–ò–õ–ê

### –ü–†–ê–í–ò–õ–û 1
–°–Ω–∞—á–∞–ª–∞ **restore availability**, –ø–æ—Ç–æ–º update `orders.status`.

–ù–∏–∫–æ–≥–¥–∞ –Ω–∞–æ–±–æ—Ä–æ—Ç.

---

### –ü–†–ê–í–ò–õ–û 2
Restore availability –¥–µ–ª–∞–µ—Ç—Å—è:
- **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑**
- **–¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ RPC**
- **–¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ order_id**

---

### –ü–†–ê–í–ò–õ–û 3
Frontend:
- –Ω–µ –≤—ã—á–∏—Å–ª—è–µ—Ç quantity
- –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã
- –Ω–µ –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É availability

---

## 6. booking.client.js ‚Äî –æ—Ç–º–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

### –†–∞–∑—Ä–µ—à–µ–Ω–æ
- –æ—Ç–º–µ–Ω–∞ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞ (48h)
- –±–µ–∑ —à—Ç—Ä–∞—Ñ–æ–≤

### –ü–æ—Ç–æ–∫:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ (`cancel.rules.js`)
2. Update `orders.status = cancelled_by_client`
3. Restore availability:
   - rental ‚Üí `restore_day_booking`
   - tour ‚Üí `restore_tour_by_order`

---

## 7. booking.provider.js ‚Äî –æ—Ç–º–µ–Ω–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º

### –†–∞–∑—Ä–µ—à–µ–Ω–æ
- –æ—Ç–º–µ–Ω–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è
- —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
- —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —à—Ç—Ä–∞—Ñ–∞–º–∏

### –ü–æ—Ç–æ–∫:
1. –í—ã–±–æ—Ä –ø—Ä–∏—á–∏–Ω—ã
2. –†–∞—Å—á—ë—Ç —à—Ç—Ä–∞—Ñ–∞ (`cancel.rules.js`)
3. Update `orders.status = cancelled_by_provider`
4. Restore availability (–ø–æ —Ç–∏–ø—É —É—Å–ª—É–≥–∏)

---

## 8. cancel.rules.js ‚Äî –±–∏–∑–Ω–µ—Å-—è–¥—Ä–æ

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ:
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω—è—Ç—å
- —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —à—Ç—Ä–∞—Ñ—ã
- —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

### –í—Ö–æ–¥
```js
getCancelPolicy({
  booking,
  cancelledBy,
  reason?
})

{
  allowed,
  status,
  penaltyPercent,
  restoreAvailability,
  message?
}

9. Restore availability –ø–æ —Ç–∏–ø—É —É—Å–ª—É–≥–∏
–¢–∏–ø —É—Å–ª—É–≥–∏	Restore RPC
rental	restore_day_booking (–ø–æ –¥–Ω—è–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
tour	restore_tour_by_order(order_id)
10. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω

–ø–æ–≤—Ç–æ—Ä–Ω—ã–π restore –Ω–µ –¥–æ–ª–∂–µ–Ω –ª–æ–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

restore –±–µ–∑–æ–ø–∞—Å–µ–Ω –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –≤—ã–∑–æ–≤–∞–º

orders –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

11. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–ó–ê–ü–†–ï–©–ï–ù–û)

‚ùå –ù–µ–ª—å–∑—è:

–¥–µ–ª–∞—Ç—å restore –±–µ–∑ order_id

–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å quantity –∏–∑ frontend

–¥–µ–ª–∞—Ç—å restore –¥–æ update orders

–¥–µ–ª–∞—Ç—å restore –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

12. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Booking Flow –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥

–î–ª—è –Ω–æ–≤–æ–≥–æ activity_type:

–¥–æ–±–∞–≤–∏—Ç—å restore RPC

–¥–æ–±–∞–≤–∏—Ç—å apply RPC

–ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ booking.client.js

–ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ booking.provider.js

–ù–ï –º–µ–Ω—è—Ç—å Cancel Contract

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 8. Service Flow (UI, Availability, Cart)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **Service Flow ‚Äî —Ñ–∞–∑—É –î–û –ø–æ–∫—É–ø–∫–∏**:
–≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É.

Service Flow **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ availability.

---

## 1. –ì—Ä–∞–Ω–∏—Ü–∞ Service Flow

Service Flow –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç:
- –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ `cart_items`

Service Flow:
- ‚ùå –Ω–µ —Å–æ–∑–¥–∞—ë—Ç orders
- ‚ùå –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç availability
- ‚ùå –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –æ–ø–ª–∞—Ç—ã
- ‚ùå –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –æ—Ç–º–µ–Ω—ã

---

## 2. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Service Flow

### –§–∞–π–ª—ã
- `service.html` ‚Äî HTML shell
- `service.js` ‚Äî entry-point
- `service.base.js` ‚Äî orchestrator

---

## 3. service.base.js ‚Äî orchestrator

### –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥–∏ (`services`)
- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `activity_type`
- –∑–∞–≥—Ä—É–∑–∫–∞ availability-–¥–∞–Ω–Ω—ã—Ö
- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ –ª–æ–≥–∏–∫–∏
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É

### –ù–ï –¥–µ–ª–∞–µ—Ç
- —Ä–∞—Å—á—ë—Ç availability
- –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω
- —Ä–∞–±–æ—Ç—É —Å orders

---

## 4. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Service Flow

### –î–ª—è rental
- RPC `get_rental_calendar`
- –¥–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω—ã backend‚Äô–æ–º
- frontend ‚Äî read-only

### –î–ª—è tour
- SELECT –∏–∑ `service_dates`
- —Ç–æ–ª—å–∫–æ `status = active`
- —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ

---

## 5. UI-–ª–æ–≥–∏–∫–∞ –ø–æ —Ç–∏–ø—É —É—Å–ª—É–≥–∏

### rental

–§–∞–π–ª—ã:
- `service.rental.js`
- `service.availability.rental.js`

–§—É–Ω–∫—Ü–∏–∏:
- –≤—ã–±–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
- –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- —Ä–∞—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π
- —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
- –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞

---

### tour

–§–∞–π–ª—ã:
- `service.tour.js`
- `service.availability.tour.js`

–§—É–Ω–∫—Ü–∏–∏:
- –≤—ã–±–æ—Ä –æ–¥–Ω–æ–π –¥–∞—Ç—ã
- –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- price override
- —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã

---

## 6. service.availability.* ‚Äî –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –ü—Ä–∏–Ω—Ü–∏–ø
- –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ Supabase
- –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ UI
- –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ orders

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- —Ä–∞—Å—á—ë—Ç—ã
- –ø—Ä–æ–≤–µ—Ä–∫–∏
- –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

–≠—Ç–æ **—á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**, –ø—Ä–∏–≥–æ–¥–Ω–∞—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## 7. cartData ‚Äî –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç Service Flow

### –§–æ—Ä–º–∞—Ç
```js
cartData = {
  service_date_id: uuid | null,
  booking_date: date | null,
  booking_date_from: date | null,
  booking_date_to: date | null,
  quantity: number,
  unit_price: number,
  total_price: number
}
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

rental ‚Üí –≤—Å–µ–≥–¥–∞ booking_date_from + booking_date_to

tour ‚Üí –≤—Å–µ–≥–¥–∞ booking_date

quantity ‚â• 1

8. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
–ì–¥–µ

service.base.js

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

insert –≤ cart_items

–Ω–∏–∫–∞–∫–æ–π availability-–ª–æ–≥–∏–∫–∏

9. Cart Flow (–∫—Ä–∞—Ç–∫–æ)

cart.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç cart_items

–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏

checkout –∑–∞–ø—É—Å–∫–∞–µ—Ç Stripe

‚ùó Cart Flow –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ availability.

10. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Service Flow –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥

–î–ª—è –Ω–æ–≤–æ–≥–æ activity_type:

—Å–æ–∑–¥–∞—Ç—å:

service.<type>.js

service.availability.<type>.js

–ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ service.base.js

–∑–∞–ø–æ–ª–Ω–∏—Ç—å cartData

–ù–ï —Ç—Ä–æ–≥–∞—Ç—å Booking Flow

11. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–ó–ê–ü–†–ï–©–ï–ù–û)

‚ùå –ù–µ–ª—å–∑—è:

—á–∏—Ç–∞—Ç—å orders –≤ Service Flow

–≤—ã—á–∏—Å–ª—è—Ç—å availability –Ω–∞ frontend

–ø—Ä–∏–º–µ–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

–ø–∏—Å–∞—Ç—å –≤ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 9. Provider Area & Admin Area

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–∑–æ–Ω—É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –∑–æ–Ω—É**:
—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏, –¥–∞—Ç–∞–º–∏, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏, –≤—ã–ø–ª–∞—Ç–∞–º–∏ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π.

---

## 1. –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø Provider Area

Provider Area –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ **–¢–û–õ–¨–ö–û –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- —Å–≤–æ–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏
- —Å–≤–æ–∏–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- —Å–≤–æ–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

Provider Area:
- ‚ùå –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑—ã
- ‚ùå –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–ª–∞—Ç–∞–º–∏
- ‚ùå –Ω–µ –º–µ–Ω—è–µ—Ç —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå –Ω–µ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è –≤ availability –Ω–∞–ø—Ä—è–º—É—é (–∫—Ä–æ–º–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)

---

## 2. Provider Dashboard

### –§–∞–π–ª—ã
- `dashboard-provider.html`
- `provider-dashboard.js`

### –§—É–Ω–∫—Ü–∏–∏
- –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –¥–æ—Ö–æ–¥—ã
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- future: –≤—ã–ø–ª–∞—Ç—ã

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- `orders`
- –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ view / RPC

---

## 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

### –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
–§–∞–π–ª—ã:
- `provider-services.html`
- `provider-services.js`

–§—É–Ω–∫—Ü–∏–∏:
- –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- —Å—Ç–∞—Ç—É—Å —É—Å–ª—É–≥–∏ (active / inactive)

---

### –°–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥–∏

–§–∞–π–ª—ã:
- `add-service.html`
- `add-service.js`

–§—É–Ω–∫—Ü–∏–∏:
- –≤–≤–æ–¥ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥–∏
- –≤—ã–±–æ—Ä `activity_type`
- —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `services`

‚ùó Availability –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–¥–µ—Å—å.

---

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏

–§–∞–π–ª—ã:
- `edit-service.html`
- `edit-service.js`

–§—É–Ω–∫—Ü–∏–∏:
- —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç–∞–º–∏ (tour)
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (rental)
- price override

---

## 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ availability –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º

### –î–ª—è rental
- —Ç–∞–±–ª–∏—Ü–∞: `service_unavailability`
- provider –º–æ–∂–µ—Ç:
  - –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–Ω–∏
  - —á–∞—Å—Ç–∏—á–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –µ–¥–∏–Ω–∏—Ü—ã
- –ù–ï –º–æ–∂–µ—Ç:
  - –º–µ–Ω—è—Ç—å `service_day_bookings`

---

### –î–ª—è tour
- —Ç–∞–±–ª–∏—Ü–∞: `service_dates`
- provider –º–æ–∂–µ—Ç:
  - –¥–æ–±–∞–≤–ª—è—Ç—å –¥–∞—Ç—ã
  - –º–µ–Ω—è—Ç—å capacity
  - –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É
- –ù–ï –º–æ–∂–µ—Ç:
  - –º–µ–Ω—è—Ç—å `booked`

---

## 5. Provider Bookings

### –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
–§–∞–π–ª—ã:
- `provider-bookings.html`
- `provider-bookings.js`

–§—É–Ω–∫—Ü–∏–∏:
- –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
- –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º
- –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (provider)

---

### –ê—Ä—Ö–∏–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
–§–∞–π–ª—ã:
- `provider-bookings-archive.html`
- `provider-bookings-archive.js`

–§—É–Ω–∫—Ü–∏–∏:
- read-only –∞—Ä—Ö–∏–≤
- –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–º–µ–Ω

---

## 6. Provider Payouts

–§–∞–π–ª—ã:
- `provider-payouts.html`
- `provider-payouts.js`

–§—É–Ω–∫—Ü–∏–∏:
- –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
- future: payout automation

---

## 7. Admin Area

### –§–∞–π–ª—ã
- `admin.html`
- `admin.js`

### –§—É–Ω–∫—Ü–∏–∏
- –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
- –º–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥
- –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
- future: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

‚ùó Admin Area –∏—Å–ø–æ–ª—å–∑—É–µ—Ç service role –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ RLS.

---

## 8. Access Control

| –†–æ–ª—å | Provider Area | Admin Area |
|----|----|----|
| guest | ‚ùå | ‚ùå |
| client | ‚ùå | ‚ùå |
| provider | ‚úÖ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ) | ‚ùå |
| admin | ‚ùå | ‚úÖ |

---

## 9. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã Provider/Admin Area

- provider –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- provider –ù–ï –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—ã
- admin –Ω–µ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è –≤ booking flow –Ω–∞–ø—Ä—è–º—É—é
- –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –ë–î + RLS

---

## 10. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–ó–ê–ü–†–ï–©–ï–ù–û)

‚ùå –ù–µ–ª—å–∑—è:
- –º–µ–Ω—è—Ç—å `orders` –∏–∑ provider UI –Ω–∞–ø—Ä—è–º—É—é
- –º–µ–Ω—è—Ç—å `booked` –∏–ª–∏ `booked_units`
- —Å–æ–∑–¥–∞–≤–∞—Ç—å RPC –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
- –¥–∞–≤–∞—Ç—å provider –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º —É—Å–ª—É–≥–∞–º

---

## 11. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Provider/Admin Area

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥:
- Provider UI —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è, –Ω–æ:
  - –ª–æ–≥–∏–∫–∞ availability –æ—Å—Ç–∞—ë—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π
- Admin UI:
  - –æ—Å—Ç–∞—ë—Ç—Å—è agnostic –∫ —Ç–∏–ø–∞–º —É—Å–ª—É–≥

---

### –°—Ç–∞—Ç—É—Å
–ß–ê–°–¢–¨ 9 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞. Provider –∏ Admin –∑–æ–Ω—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã.

# SOURCE OF TRUTH
## –ß–ê–°–¢–¨ 10. External Integrations, Edge Functions, Monitoring & Future-proofing

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**, Edge Functions, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–∏ –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç —Å–∏—Å—Ç–µ–º—É —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫ –±—É–¥—É—â–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.

---

## 1. –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- –ù–ï —è–≤–ª—è—é—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã
- –ù–ï —Ö—Ä–∞–Ω—è—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –ù–ï —É–ø—Ä–∞–≤–ª—è—é—Ç availability –Ω–∞–ø—Ä—è–º—É—é

–û–Ω–∏:
- —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç —Å–æ–±—ã—Ç–∏—è
- –ø–µ—Ä–µ–¥–∞—é—Ç —Å–∏–≥–Ω–∞–ª—ã
- –∑–∞–ø—É—Å–∫–∞—é—Ç backend-–ª–æ–≥–∏–∫—É

---

## 2. Stripe (Payments)

### –†–æ–ª—å Stripe
- –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∞ –æ–ø–ª–∞—Ç—ã

Stripe:
- –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ç–∏–ø–∞—Ö —É—Å–ª—É–≥
- –Ω–µ –∑–Ω–∞–µ—Ç –æ –¥–∞—Ç–∞—Ö
- –Ω–µ –∑–Ω–∞–µ—Ç –æ–± availability

---

### Stripe Webhook

–¢–∏–ø:
- backend script / Edge Function
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **service role key**

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ —Å–æ–±—ã—Ç–∏–µ:
checkout.session.completed


–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:
1. –∑–∞–≥—Ä—É–∑–∫–∞ `cart_items`
2. –ø—Ä–æ–≤–µ—Ä–∫–∞ availability (rental)
3. —Å–æ–∑–¥–∞–Ω–∏–µ `orders`
4. –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ availability (RPC)
5. –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã

‚ùó Stripe webhook ‚Äî **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—á–∫–∞ —Å–∏—Å—Ç–µ–º—ã**.

---

## 3. Telegram Bot

### –§–∞–π–ª
- `telegram-bot.js`

### –¢–∏–ø
- –≤–Ω–µ—à–Ω–∏–π backend-—Å–µ—Ä–≤–∏—Å
- –ù–ï frontend
- –ù–ï Edge Function

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª—é—á–∏
- Telegram Bot Token
- Supabase Service Role Key

### –§—É–Ω–∫—Ü–∏–∏
- —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- future: support / alerts

‚ùó Telegram Bot –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ö–æ–¥–∏—Ç RLS.

---

## 4. Edge Functions (Supabase)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- secure backend logic
- –æ–ø–µ—Ä–∞—Ü–∏–∏, –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ frontend
- Stripe webhook
- future: payouts, refunds

### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
- –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service role
- –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É frontend

---

## 5. Monitoring & Logging

### –ì–¥–µ –ª–æ–≥–∏—Ä—É–µ–º
- Stripe webhook
- Edge Functions
- critical RPC

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
- –æ—à–∏–±–∫–∏ availability
- –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ orders ‚Üî availability
- –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–º–µ–Ω—ã
- failed payments

‚ùó –û—à–∏–±–∫–∏ availability ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ.

---

## 6. Recovery Strategy (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- order —Å–æ–∑–¥–∞–Ω, availability –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- availability –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –¥–≤–∞–∂–¥—ã
- –æ—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è
- orders = Source of Truth
- availability –≤—Å–µ–≥–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ orders
- –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä—É—á–Ω–æ–π reconcile

---

## 7. Future-proofing: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥

### –ß–¢–û –ù–ï–õ–¨–ó–Ø –¥–µ–ª–∞—Ç—å
- –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã
- –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å Service Flow
- –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –≤ Cancel Contract

---

### –ß–¢–û –ù–£–ñ–ù–û –¥–µ–ª–∞—Ç—å

–î–ª—è –Ω–æ–≤–æ–≥–æ `activity_type`:

1. **Service Flow**
   - `service.<type>.js`
   - `service.availability.<type>.js`

2. **Database**
   - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `orders`
   - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –Ω–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

3. **RPC**
   - `apply_<type>_booking_by_order`
   - `restore_<type>_by_order`

4. **Booking Flow**
   - –ø–æ–¥–∫–ª—é—á–∏—Ç—å restore –≤:
     - `booking.client.js`
     - `booking.provider.js`

‚ùó –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –ù–ï –¢–†–û–ì–ê–¢–¨.

---

## 8. Anti-patterns (–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û)

‚ùå –ù–µ–ª—å–∑—è:
- –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–∏–ø —É—Å–ª—É–≥–∏ –±–µ–∑ restore RPC
- –≤—ã—á–∏—Å–ª—è—Ç—å availability –≤–æ frontend
- –º–µ–Ω—è—Ç—å orders –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service role –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

---

## 9. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

### Source of Truth:
- –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
- —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- —á–∏—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏

–ï—Å–ª–∏ –∫–æ–¥ ‚â† –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π.

---

## 10. –§–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Å–∏—Å—Ç–µ–º—ã

> ‚ùó **Orders ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.  
> –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.**

---

### –°—Ç–∞—Ç—É—Å
–ß–ê–°–¢–¨ 10 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π.

# SOURCE OF TRUTH ‚Äî ADMIN PANEL (ActiveGo)

## –°—Ç–∞—Ç—É—Å
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤—Ä—É—á–Ω—É—é  
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production-ready MVP  
‚õî –ò–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ, —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

## 1. –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ê–î–ú–ò–ù–ö–ò

–ê–¥–º–∏–Ω–∫–∞ ActiveGo –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É:

- –µ–¥–∏–Ω—ã–π layout
- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö HTML-—Ñ–æ—Ä–º
- —Å—Ç—Ä–æ–≥–∞—è —Ä–æ–ª–µ–≤–∞—è –ª–æ–≥–∏–∫–∞

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É
/admin/admin-layout.html

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

–ù–∞–≤–∏–≥–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä:
?page=<page_name>

makefile
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

–ü—Ä–∏–º–µ—Ä—ã:
/admin/admin-layout.html?page=dashboard
/admin/admin-layout.html?page=services
/admin/admin-layout.html?page=service-view&id=SERVICE_ID
/admin/admin-layout.html?page=users
/admin/admin-layout.html?page=bookings

yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

---

## 2. –†–û–õ–ò –ò –î–û–°–¢–£–ü

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`profiles.role`)
- `client`
- `provider`
- `admin`

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- Provider –≤–∏–¥–∏—Ç –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É—Å–ª—É–≥–∏**
- Admin –≤–∏–¥–∏—Ç **–≤—Å–µ —É—Å–ª—É–≥–∏, –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
  - –ª–∏–±–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Netlify Functions
  - –ª–∏–±–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `role === 'admin'`

---

## 3. –¢–ò–ü–´ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –£–°–õ–£–ì

### 3.1 Provider Edit (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª:
edit-service.html
edit-service.js

yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π
- –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å `activity_type`
- –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –∫–ª—é—á–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥–∏
- –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:
  - —Å—Ç–∞—Ç—É—Å —É—Å–ª—É–≥–∏ ‚Üí `pending`
  - –µ—Å–ª–∏ —É—Å–ª—É–≥–∞ –±—ã–ª–∞ `active`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `admin_previous_data`
- –¥–∞–ª–µ–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

---

### 3.2 Admin Quick Edit (–∫–æ—Ä–æ—Ç–∫–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ—Ç –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**, —á—Ç–æ –∏ provider edit, –Ω–æ:

- admin –∑–∞—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º–µ `mode=admin`
- –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É –ª—é–±–æ–≥–æ provider
- –∏–∑–º–µ–Ω–µ–Ω–∏—è:
  - —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
  - —Å—Ç–∞—Ç—É—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `active`
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Netlify Function

---

### 3.3 Admin Full Edit (–ü–û–õ–ù–û–ï –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï)

### üîë –ö–õ–Æ–ß–ï–í–û–ô –ò–ù–í–ê–†–ò–ê–ù–¢
> **Admin Full Edit –í–°–ï–ì–î–ê –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `add-service.html`**

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è —É—Å–ª—É–≥–∏
- —Å–æ–∑–¥–∞–≤–∞—Ç—å `admin-service-edit.html`

---

## 4. ADMIN FULL EDIT ‚Äî –û–°–ù–û–í–ù–û–ô –ú–ï–•–ê–ù–ò–ó–ú

### URL
/add-service.html?id=SERVICE_ID&mode=admin

markdown
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–∞ –∂–µ —Ñ–æ—Ä–º–∞**, —á—Ç–æ –∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É—Å–ª—É–≥–∏
- —Ñ–æ—Ä–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è** –¥–∞–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–∏
- –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å:
  - –ª—é–±–æ–π —Ç–µ–∫—Å—Ç
  - —Ü–µ–Ω—É
  - —Ç–∏–ø —É—Å–ª—É–≥–∏ (`activity_type`)
  - –≤—Å–µ `activity_details`
  - –∞–¥—Ä–µ—Å–∞, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
  - –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
  - –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã ‚Üí –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ
  - –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã ‚Üí –∑–∞–º–µ–Ω—è—é—Ç—Å—è

---

## 5. –í–ê–õ–ò–î–ê–¶–ò–ò –ò –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–û–õ–Ø

### Provider Create
- —Å—Ç—Ä–æ–≥–∏–µ HTML `required`
- —Å—Ç—Ä–æ–≥–∏–µ JS-–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ
- –ø—Ä–æ–≤–µ—Ä–∫–∏ tour / rental / duration

### Admin Full Edit
- ‚ùå –Ω–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö HTML –ø–æ–ª–µ–π
- ‚ùå –Ω–µ—Ç JS-–≤–∞–ª–∏–¥–∞—Ü–∏–π
- ‚ùå –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:
- –≤—Å–µ `required` —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ `mode=admin`
- –≤—Å–µ JS-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–±—ë—Ä–Ω—É—Ç—ã –≤ `if (!isAdminEdit)`

---

## 6. CREATE vs UPDATE –õ–û–ì–ò–ö–ê

### Provider
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `INSERT`
- —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —É—Å–ª—É–≥–∞
- —Å—Ç–∞—Ç—É—Å `pending`

### Admin Full Edit
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `UPDATE`
- **–ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —É—Å–ª—É–≥–∞**
- —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ `active`
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ Netlify Function

---

## 7. NETLIFY FUNCTIONS (ADMIN)

### admin-service-edit.js
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –æ–±—Ö–æ–¥ RLS Supabase

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
- admin quick edit
- admin full edit

–ü—Ä–∏–Ω—Ü–∏–ø:
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `service_id` –∏ `payload`
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç `update` —á–µ—Ä–µ–∑ `supabaseAdmin`

---

## 8. –†–ï–î–ò–†–ï–ö–¢–´ –ü–û–°–õ–ï –°–û–•–†–ê–ù–ï–ù–ò–Ø

### Admin Full Edit
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
/admin/admin-layout.html?page=service-view&id=SERVICE_ID

yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

–†–µ–¥–∏—Ä–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ~800ms, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ.

### Provider
- —Ñ–æ—Ä–º–∞ –æ—á–∏—â–∞–µ—Ç—Å—è
- –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è

---

## 9. –ö–ù–û–ü–ö–ò –í –ê–î–ú–ò–ù–ö–ï

### –í admin-service-view
- "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (–±—ã—Å—Ç—Ä–æ)" ‚Üí edit-service.html?mode=admin
- "–ü–æ–ª–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" ‚Üí
/add-service.html?id=SERVICE_ID&mode=admin

yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

---

## 10. –ó–ê–ü–†–ï–¢–´ –ò –ò–ù–í–ê–†–ò–ê–ù–¢–´

‚õî –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É add-service
- –¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é admin-—Ñ–æ—Ä–º—É
- –æ–±—Ö–æ–¥–∏—Ç—å admin-layout
- –¥–µ–ª–∞—Ç—å INSERT –ø—Ä–∏ admin-edit

‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ:
- –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã —á–µ—Ä–µ–∑ URL
- —Ä–∞—Å—à–∏—Ä—è—Ç—å activity_details
- –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è admin

---

## 11. –§–ò–õ–û–°–û–§–ò–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–´

- –æ–¥–Ω–∞ —Ñ–æ—Ä–º–∞ = –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- —Ä–µ–∂–∏–º—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è URL
- —Ä–æ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- admin ‚Äî –º–∞–∫—Å–∏–º—É–º —Å–≤–æ–±–æ–¥—ã
- provider ‚Äî –º–∞–∫—Å–∏–º—É–º –∑–∞—â–∏—Ç—ã –æ—Ç –æ—à–∏–±–æ–∫

---

## 12. –°–¢–ê–¢–£–°

üü¢ Admin Panel ActiveGo —Å—á–∏—Ç–∞–µ—Ç—Å—è:
- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π
- –≥–æ—Ç–æ–≤–æ–π –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- –≥–æ—Ç–æ–≤–æ–π –∫ soft launch

–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ —Å –ø—Ä–∞–≤–∫–æ–π —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.