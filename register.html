<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî ActiveGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="header"></div>
<script type="module" src="header.js"></script>

<div class="container" style="max-width:480px;">

  <h1 id="registerTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h1>

  <p style="font-size:14px;color:#666;margin-bottom:12px;">
    –í—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ—Å—å –∫–∞–∫ <strong id="roleLabel">–∫–ª–∏–µ–Ω—Ç</strong>
  </p>

  <!-- üß† –°–ú–´–°–õ–û–í–û–ô –ë–õ–û–ö -->
  <div
    id="roleDescription"
    style="
      font-size:15px;
      line-height:1.5;
      margin-bottom:24px;
      padding:14px 16px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
      border-radius:12px;
    "
  >
    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã:
    <br>‚Ä¢ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥–∏
    <br>‚Ä¢ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏
    <br>‚Ä¢ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  </div>

  <form id="registerForm">

    <!-- üîë –†–û–õ–¨ (–ò–°–¢–û–ß–ù–ò–ö –ü–†–ê–í–î–´) -->
    <input type="hidden" id="role" value="client">

    <input type="text" id="name" placeholder="–ò–º—è" required><br><br>
    <input type="email" id="email" placeholder="Email" required><br><br>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br><br>

    <button type="submit" class="btn" style="width:100%;">
      –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
    </button>

  </form>

  <div id="result" style="margin-top:12px;"></div>

  <hr style="margin:30px 0;">

  <!-- GOOGLE -->
  <p style="font-size:14px;color:#666;margin-bottom:10px;">
    –ò–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑
  </p>

  <button
    id="googleRegisterBtn"
    type="button"
    class="btn btn-outline"
    style="width:100%;"
  >
    <img
      src="https://www.svgrepo.com/show/475656/google-color.svg"
      style="width:18px;vertical-align:middle;margin-right:8px;"
    >
    Google
  </button>

  <hr style="margin:30px 0;">

  <p style="font-size:14px;margin-bottom:8px;">
    –•–æ—Ç–∏—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ ActiveGo?
  </p>

  <!-- üîÅ –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –†–û–õ–ò -->
  <button
    id="switchRoleBtn"
    type="button"
    class="btn btn-outline"
    style="width:100%;"
  >
    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫
  </button>

</div>

<script type="module" src="auth.js"></script>

<script type="module">
  import { supabase } from './supabaseClient.js';

  const roleInput = document.getElementById('role');
  const roleLabel = document.getElementById('roleLabel');
  const titleEl   = document.getElementById('registerTitle');
  const switchBtn = document.getElementById('switchRoleBtn');
  const googleBtn = document.getElementById('googleRegisterBtn');
  const descBox   = document.getElementById('roleDescription');

  /* =========================
     ROLE UI
  ========================= */
  function setRole(role) {
    if (role === 'provider') {
      roleInput.value = 'provider';
      roleLabel.textContent = '–ø–æ—Å—Ç–∞–≤—â–∏–∫';
      titleEl.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞';
      switchBtn.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç';

      descBox.innerHTML = `
        –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞, —á—Ç–æ–±—ã:
        <br>‚Ä¢ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏
        <br>‚Ä¢ –ø–æ–ª—É—á–∞—Ç—å –∑–∞–∫–∞–∑—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
        <br>‚Ä¢ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–æ—Ö–æ–¥ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        <br><br>
        –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
        –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø—Ä–æ–π—Ç–∏ –º–æ–¥–µ—Ä–∞—Ü–∏—é.
      `;
    } else {
      roleInput.value = 'client';
      roleLabel.textContent = '–∫–ª–∏–µ–Ω—Ç';
      titleEl.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞';
      switchBtn.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫';

      descBox.innerHTML = `
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã:
        <br>‚Ä¢ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥–∏
        <br>‚Ä¢ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏
        <br>‚Ä¢ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      `;
    }
  }

  /* =========================
     ROLE SWITCH BUTTON
  ========================= */
  switchBtn.addEventListener('click', (e) => {
    e.preventDefault();

    const nextRole =
      roleInput.value === 'client'
        ? 'provider'
        : 'client';

    setRole(nextRole);
  });

  /* =========================
     INIT ROLE FROM URL
     /register.html?role=provider
  ========================= */
  const params = new URLSearchParams(window.location.search);
  const initialRole = params.get('role');

  if (initialRole === 'provider') {
    setRole('provider');
  }

  /* =========================
     GOOGLE REGISTRATION
  ========================= */
  googleBtn.addEventListener('click', async () => {
    const role = roleInput.value;

    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo:
          window.location.origin +
          '/oauth-callback.html?role=' +
          role
      }
    });

    if (error) {
      alert(error.message);
    }
  });
</script>

</body>
</html>
