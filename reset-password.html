<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Новый пароль — ActiveGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="header"></div>
<script type="module" src="header.js"></script>

<div class="container" style="max-width:480px;">

  <h1>Новый пароль</h1>

  <p style="font-size:14px;color:#666;margin-bottom:20px;">
    Придумайте новый пароль для входа в аккаунт.
  </p>

  <form id="newPasswordForm">

    <input
      type="password"
      id="password"
      placeholder="Новый пароль"
      required
    >
    <br><br>

    <input
      type="password"
      id="passwordConfirm"
      placeholder="Повторите пароль"
      required
    >
    <br><br>

    <button class="btn" style="width:100%;">
      Сохранить пароль
    </button>

  </form>

  <div id="result" style="margin-top:16px;"></div>

</div>

<script type="module">
  import { supabase } from './supabaseClient.js';

  const form = document.getElementById('newPasswordForm');
  const result = document.getElementById('result');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const password = document.getElementById('password').value;
    const confirm  = document.getElementById('passwordConfirm').value;

    if (password.length < 6) {
      showError('Пароль должен быть не менее 6 символов');
      return;
    }

    if (password !== confirm) {
      showError('Пароли не совпадают');
      return;
    }

    const { error } = await supabase.auth.updateUser({
      password
    });

    if (error) {
      showError(error.message);
      return;
    }

    result.innerHTML = `
      <div style="
        padding:14px;
        background:#e6fffa;
        border:1px solid #b2f5ea;
        border-radius:10px;
        font-size:14px;
      ">
        ✅ Пароль успешно обновлён<br><br>
        <a href="login.html" style="color:var(--primary);">
          Перейти ко входу →
        </a>
      </div>
    `;
  });

  function showError(text) {
    result.innerHTML = `
      <div style="
        padding:14px;
        background:#fff5f5;
        border:1px solid #fed7d7;
        border-radius:10px;
        font-size:14px;
        color:#c53030;
      ">
        ❌ ${text}
      </div>
    `;
  }
</script>

</body>
</html>
